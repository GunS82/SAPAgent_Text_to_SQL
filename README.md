# SapSqlAgent: LLM-агент для работы с SAP

Проект представляет собой **AI-агента**, который позволяет получать данные из системы SAP, используя запросы на естественном языке. Агент преобразует ваш вопрос в SQL-запрос, выполняет его в SAP и предоставляет готовый ответ.

Это **экспериментальный проект**, демонстрирующий возможности интеграции больших языковых моделей (LLM) с корпоративными системами, такими как SAP.

## Основная идея

Многие бизнес-пользователи нуждаются в данных из SAP, но не обладают техническими знаниями для написания SQL-запросов или использования транзакций SAP. **SapSqlAgent** решает эту проблему, предоставляя простой интерфейс для взаимодействия с системой через естественный язык.

Пользователь просто пишет вопрос, например: *"Покажи мне 10 последних счетов-фактур для клиента X"*, а агент делает все остальное.

## Как это работает?

Процесс работы агента состоит из нескольких шагов:
1.  **Понимание запроса**: Агент анализирует вопрос пользователя с помощью LLM.
2.  **Формирование SQL**: На основе анализа LLM генерирует SQL-запрос, который может быть выполнен в SAP.
3.  **Выполнение в SAP**: С помощью GUI-скриптинга агент открывает SAP, вставляет и выполняет сгенерированный SQL-запрос.
4.  **Получение результата**: Результат выполнения забирается из SAP.
5.  **Ответ пользователю**: Агент анализирует полученные данные и формирует ответ на языке пользователя.

В проекте реализовано два подхода:
*   **Reasoning Agent (`SapSqlAgent_Reason.py`)**: Многошаговый агент, который сначала исследует таблицы и поля, а затем строит финальный запрос.
*   **Direct Agent (`SapSqlAgent_Direct.py`)**: Упрощенный агент, который пытается сгенерировать SQL-запрос за один шаг.

## Ключевые возможности

*   **Преобразование естественного языка в SQL** для систем SAP.
*   **Автоматизация взаимодействия с SAP** через GUI-скриптинг.
*   **Два режима работы**: пошаговый (reasoning) и прямой (direct).
*   **Логирование всех диалогов** и SQL-запросов в локальную базу данных (SQLite) для анализа и отладки.
*   **Инструменты для работы с метаданными SAP**: получение информации о полях таблиц, доменах и т.д.

## Основные компоненты

*   `SapSqlAgent_Reason.py` / `SapSqlAgent_Direct.py` — два варианта реализации агента.[1][2]
*   `sap_tools.py` — модуль для взаимодействия с SAP GUI (выполнение запросов, получение метаданных).[3]
*   `db_logger.py` — система логирования диалогов и результатов.[4]
*   `utils.py` — вспомогательные утилиты, например, для извлечения JSON из текста.[5]

## Начало работы

Для запуска проекта вам потребуется:
1.  Python 3.x.
2.  Установленный SAP GUI с включенной поддержкой скриптов.
3.  Ключи доступа к API языковой модели (LLM).

Настройте переменные окружения с вашими ключами и параметрами подключения в файле `.env`.

> **Внимание!**
> Проект использует автоматизацию графического интерфейса пользователя (GUI scripting) для взаимодействия с SAP. Это может быть небезопасно и создавать нагрузку на систему. Используйте его с осторожностью и предпочтительно в тестовых средах.
